# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–µ–≤–∏–∑–∏—é

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞**: –¥–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –ø–æ–ª–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ–ø–∏—Å–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ —Ä–µ–≤–∏–∑–∏–∏ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–µ –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π.

---

## 1. –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

```
project-root/
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ architecture.md        # (—Å—Ç–∞—Ä—ã–π, –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)
‚îú‚îÄ‚îÄ scheduler_runner/          # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–∫–µ—Ç —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á
‚îÇ   ‚îú‚îÄ‚îÄ runner.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: –ø–∞—Ä—Å–∏–Ω–≥, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –∑–∞–ø—É—Å–∫
‚îÇ   ‚îú‚îÄ‚îÄ schedule_config.py     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ utils/                 # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ logging.py         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ subprocess.py      # –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –ø–æ–¥–ø—Ä–æ—Ü–µ—Å—Å–µ
‚îÇ       ‚îî‚îÄ‚îÄ timing.py          # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
‚îî‚îÄ‚îÄ tests/                     # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã (pytest)
    ‚îú‚îÄ‚îÄ test_logging.py
    ‚îú‚îÄ‚îÄ test_timing.py
    ‚îî‚îÄ‚îÄ test_subprocess.py
```

1. **runner.py**
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Windows Task Scheduler (—Å –≤—ã–∑–æ–≤–æ–º `pythonw runner.py --user <user> [--task <name>] [--detailed]`).
   - –ü–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã:
     - `--user` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ‚Äî –∏–º—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
     - `--task` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞ –±–µ–∑ —É—á—ë—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.
     - `--detailed` ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å DEBUG –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –∏–∑ `schedule_config.py`.
   - –í—ã–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –ø–æ –∏–º–µ–Ω–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ `--task`).
   - –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:
     1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç –ª–æ–≥–≥–µ—Ä (`configure_logger`).
     2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞:
        - –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `--task`, –≤—Å–µ–≥–¥–∞ `True`.
        - –ò–Ω–∞—á–µ ‚Äî —á–µ—Ä–µ–∑ `should_run_now(task, now)`.
     3. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –º–æ–¥—É–ª—å —á–µ—Ä–µ–∑ `run_subprocess(...)`.
     4. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

2. **schedule_config.py**
   - –°–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `SCHEDULE: List[dict]` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–¥–∞—á:
     - `user`: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
     - `name`: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∏–º—è (–∏ –∏–º—è –ª–æ–≥-—Ñ–∞–π–ª–∞).
     - `module` –∏–ª–∏ `script`: –∏–º—è –º–æ–¥—É–ª—è (`tasks.MyTask`).
     - `schedule`: `"hourly"` | `"daily"` | (—Ä–µ–∑–µ—Ä–≤ `"once"`).
     - `time`: –¥–ª—è `daily` ‚Äî —Å—Ç—Ä–æ–∫–∞ `"HH:MM"`.
     - `args`: —Å–ø–∏—Å–æ–∫ CLI-–∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
     - `env`: –¥–æ–ø. –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
     - `timeout`: —Ç–∞–π–º–∞—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.
   - `PATH_CONFIG`: –ø—É—Ç–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º, `DEFAULT_ENV`.

3. **utils/logging.py**
   - `configure_logger(user, task_name=None, detailed=False, ...) -> Logger`:
     - –°–æ–∑–¥–∞—ë—Ç –ø–∞–ø–∫—É `logs/{user}/{task}`.
     - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª `logs/.../YYYY-MM-DD.log` (INFO).
     - –ü—Ä–∏ `detailed=True` ‚Äî –¥–æ–ø. `YYYY-MM-DD_detailed.log` (DEBUG).
     - –†–æ—Ç–∞—Ü–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10‚ÄØ–ú–ë, 5 –∫–æ–ø–∏–π).
     - –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ä—à–µ `backup_count` –¥–Ω–µ–π.
     - –§–æ—Ä–º–∞—Ç: `timestamp level [user.task] message`.
     - –õ–æ–≥–≥–µ—Ä –∫–µ—à–∏—Ä—É–µ—Ç—Å—è (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–µ –¥–æ–±–∞–≤–ª—è—é—Ç —Ö–µ–Ω–¥–ª–µ—Ä—ã).

4. **utils/timing.py**
   - `should_run_now(task: dict, now: datetime) -> bool`:
     - `hourly` ‚Üí –≤—Å–µ–≥–¥–∞ `True`.
     - `daily` ‚Üí `True` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `now.hour –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ HH and now.minute –±–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ MM`.
       - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤: –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —á–∞—Å—É –±—É–¥–µ—Ç `False`.
     - `once` ‚Üí –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ (–≤ –±—É–¥—É—â–µ–º).
     - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ `time`.

5. **utils/subprocess.py**
   - `run_subprocess(script_name: str, args: List[str], env: dict, logger, timeout: int) -> bool`:
     - –ó–∞–ø—É—Å–∫–∞–µ—Ç `pythonw -m <script_name> args...`.
     - –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `env.get('PWD')` –∏–ª–∏ —Ç–µ–∫—É—â–∞—è.
     - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç `os.environ` –∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ `env`.
     - –õ–æ–≥–∏—Ä—É–µ—Ç `stdout` –∏ `stderr` –Ω–∞ DEBUG.
     - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞: lock-—Ñ–∞–π–ª –≤ `tempfile.gettempdir()`.
     - –¢–∞–π–º–∞—É—Ç –∏ —É–±–∏–π—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.
     - –£–¥–∞–ª–µ–Ω–∏–µ lock-—Ñ–∞–π–ª–∞.
     - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `True` –ø—Ä–∏ `exit_code == 0`, –∏–Ω–∞—á–µ `False`.

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–µ–≤–∏–∑–∏—é –∏ –¥–æ—Ä–∞–±–æ—Ç–∫—É

### üìå –¶–µ–ª—å
–ü–æ–ª–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –º–æ–¥—É–ª–µ–π:
- `runner.py`
- `utils/logging.py`
- `utils/subprocess.py`
- `utils/timing.py`

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–§–ª–∞–≥ `--task`**
   - –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `--task` –≤—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å –∑–∞–¥–∞—á—É, –∏–≥–Ω–æ—Ä–∏—Ä—É—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.

2. **Scheduling Logic (`should_run_now`)**
   - `hourly`: –≤—Å–µ–≥–¥–∞ `True`.
   - `daily`: –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é `HH:MM`.
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞, –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—É—Å–∫ –≤–∏—Å–∏—Ç –¥–æ–ª—å—à–µ —á–∞—Å–∞.
   - `once`: –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ–º.

3. **–ó–∞–ø—É—Å–∫ –≤ –ø–æ–¥–ø—Ä–æ—Ü–µ—Å—Å–µ (`run_subprocess`)**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `pythonw` –≤–º–µ—Å—Ç–æ `python`.
   - –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: `PATH_CONFIG['SCRIPTS_DIR']`.
   - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ `env` –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `stdout` –∏ `stderr`.
   - –¢–∞–π–º–∞—É—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60‚ÄØ—Å –∏–ª–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞).
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ lock-—Ñ–∞–π–ª–æ–º.

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`configure_logger`)**
   - –ü–∞–ø–∫–∞ `logs/{user}/{task}`.
   - –ò–º—è –ª–æ–≥–≥–µ—Ä–∞ `{user}.{task}` (—É–Ω–∏–∫–∞–ª—å–Ω–æ, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ).
   - –û—Å–Ω–æ–≤–Ω–æ–π INFO-—Ñ–∞–π–ª: `YYYY-MM-DD.log`.
   - DEBUG-—Ñ–∞–π–ª –ø—Ä–∏ `--detailed`: `YYYY-MM-DD_detailed.log`.
   - –†–æ—Ç–∞—Ü–∏—è: 10‚ÄØ–ú–ë √ó 5 –∫–æ–ø–∏–π.
   - –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ä—à–µ 5 –¥–Ω–µ–π.
   - –§–æ—Ä–º–∞—Ç: `timestamp level [user.task] message`.

5. **runner.py**
   - –ü–∞—Ä—Å–∏–Ω–≥ `--user`, `--task`, `--detailed`.
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á –ø–æ `user` –∏ `task`.
   - –í—ã–∑–æ–≤ `configure_logger`.
   - –õ–æ–≥–∏–∫–∞ `run_now = (args.task is set) or should_run_now(...)`.
   - –í—ã–∑–æ–≤ `run_subprocess`.
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

6. **Unit-—Ç–µ—Å—Ç—ã**
   - `pytest` (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ).
   - –ü–æ–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏ edge-cases:
     - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã `configure_logger`.
     - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏.
     - `hourly` vs `daily`.
     - –£—Å–ø–µ—à–Ω—ã–π –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–π `run_subprocess`.
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –ª–æ–≥-—Ñ–∞–π–ª–æ–≤, lock-—Ñ–∞–π–ª–∞.

### üîÄ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Ç–æ—á–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.
- –î–æ–±–∞–≤–∏—Ç—å docstring-–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –æ–ø–∏—Å–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.
- –ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å PEP8 –∏ –±—ã—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω (–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤).
- –õ—ë–≥–∫–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

---

*–ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∑–∞–¥–∞—á–µ.*