# Parser_KPI_Carriages_OzonScript

Скрипт для автоматического парсинга данных о перевозках (прямые и возвратные) из ERP-системы ОЗОН.

## Функциональность

- Парсинг веб-страницы ОЗОН для получения данных о перевозках
- Поддержка фильтрации по дате и типу перевозок (прямые/возвратные)
- Извлечение детальной информации о перевозках (номера, количество отправлений)
- Двухэтапный процесс: сначала прямые, затем возвратные перевозки
- Сохранение данных в формате JSON
- Совместимость с системой отчетов

## Использование

```bash
# Запуск с текущей датой
python Parser_KPI_Carriages_OzonScript.py --detailed_logs

# Запуск с указанной датой
python Parser_KPI_Carriages_OzonScript.py --date 2026-01-06 --detailed_logs
```

## Параметры

- `--detailed_logs` - включить детализированные логи
- `--date DATE` - дата для парсинга в формате YYYY-MM-DD (по умолчанию - сегодня)

## Выходные данные

Скрипт создает JSON-файл с данными о перевозках в директории `reports/json/` с именем в формате `ozon_carriages_report_{pvz}_{date}.json`.

## Архитектура

Скрипт следует унифицированной архитектуре проекта:
- Использует базовый класс `BaseOzonParser`
- Совместим с системой `load_reports_data`
- Использует конфигурацию из `Parser_KPI_Carriages_OzonScript_config.py`
- Поддерживает интеграцию с Google Sheets и системой уведомлений

## Особенности реализации

- Формирование URL осуществляется по шаблону из конфигурации (`ERP_URL_TEMPLATE`, `DIRECT_FLOW_URL_TEMPLATE`, `RETURN_FLOW_URL_TEMPLATE`)
- Фильтрация по дате и типу перевозок реализована через шаблоны (`DATE_FILTER_TEMPLATE`, `FLOW_TYPE_FILTER_TEMPLATE`, `DATE_FORMAT`)
- Нет хардкода формирования URL в скрипте - все параметры определены в конфигурации
- При изменении формата URL в ERP достаточно обновить шаблоны в конфигурационном файле
- Реализован двухэтапный процесс извлечения данных для прямых и возвратных перевозок
- Для каждой перевозки извлекаются номер и количество отправлений
- Объединение результатов в один отчет с вложенной структурой данных