# Документация парсера отчетов

## Общее описание

Парсер отчетов — это модульная система для извлечения данных из веб-приложений с использованием Selenium WebDriver. Архитектура парсера построена на принципах объектно-ориентированного программирования с использованием абстрактных классов и наследования, что позволяет легко расширять функциональность для различных веб-систем.

## Архитектура

### Иерархия классов

```
BaseParser (абстрактный класс)
  ↓
BaseReportParser (абстрактный класс)
  ↓
OzonReportParser (абстрактный класс)
  ↓
Конкретные реализации (например, GiveoutReportParser)
```

#### BaseParser
Базовый класс, предоставляющий общую функциональность для работы с веб-браузером:
- Управление сессией браузера (настройка, закрытие)
- Универсальные методы для взаимодействия с элементами страницы
- Поддержка различных типов элементов (input, select, checkbox, radio и т.д.)
- Механизмы извлечения данных из таблиц
- Обработка выпадающих списков
- Логирование

**Абстрактные методы:**
- [login()](BaseParser/login().md) - реализация логики входа в систему
- [navigate_to_target()](BaseParser/navigate_to_target().md) - реализация навигации к целевой странице
- [extract_data()](BaseParser/extract_data().md) - реализация извлечения данных
- [logout()](BaseParser/logout().md) - реализация выхода из системы

**Основные методы:**
- [setup_browser()](BaseParser/setup_browser().md) - настройка веб-браузера
- [close_browser()](BaseParser/close_browser().md) - закрытие браузера
- [get_element_value()](BaseParser/get_element_value().md) - получение значения элемента
- [set_element_value()](BaseParser/set_element_value().md) - установка значения элемента
- [extract_table_data()](BaseParser/extract_table_data().md) - извлечение данных из таблицы
- [_select_option_from_dropdown()](BaseParser/_select_option_from_dropdown().md) - выбор опции из выпадающего списка
- [run_parser()](BaseParser/run_parser().md) - запуск парсера

#### BaseReportParser
Класс, расширяющий BaseParser с функциональностью для работы с отчетами:
- Поддержка мульти-шаговой обработки данных
- Форматирование и сохранение отчетов в различных форматах (JSON, CSV, XML)
- Управление конфигурацией отчетов
- Валидация данных отчета
- Поддержка аргументов командной строки
- Формирование URL с фильтрами

**Абстрактные методы:**
- [get_report_type()](BaseReportParser/get_report_type().md) - возвращает тип отчета
- [extract_report_data()](BaseReportParser/extract_report_data().md) - извлекает специфичные данные отчета

**Основные методы:**
- [run_parser()](BaseReportParser/run_parser().md) - запуск парсера отчетов (переопределенный метод)
- [format_report_output()](BaseReportParser/format_report_output().md) - форматирование данных отчета
- [save_report()](BaseReportParser/save_report().md) - сохранение отчета в файл
- [_execute_multi_step_processing()](BaseReportParser/_execute_multi_step_processing().md) - выполнение мульти-шаговой обработки
- [_build_url_filter()](BaseReportParser/_build_url_filter().md) - формирование фильтра для URL
- [get_common_report_info()](BaseReportParser/get_common_report_info().md) - получение общей информации отчета

#### OzonReportParser
Класс, расширяющий BaseReportParser с функциональностью для работы с системой Ozon ПВЗ:
- Проверка и установка правильного ПВЗ
- Обеспечение корректной работы с конкретным пунктом выдачи
- Интеграция с логикой навигации для проверки ПВЗ

**Основные методы:**
- [get_current_pvz()](OzonReportParser/get_current_pvz().md) - извлечение текущего ПВЗ
- [set_pvz()](OzonReportParser/set_pvz().md) - установка нужного ПВЗ
- [ensure_correct_pvz()](OzonReportParser/ensure_correct_pvz().md) - проверка правильного ПВЗ

## Схема потоков данных

```
┌─────────────────┐    ┌──────────────────┐    ┌──────────────────┐
│   Пользователь  │───▶│  Конфигурация   │───▶│   Парсер         │
│                 │    │   (config)      │    │                  │
└─────────────────┘    └──────────────────┘    └──────────────────┘
                                                        │
┌─────────────────┐    ┌──────────────────┐             │
│   Веб-браузер   │◀───│  Управление     │◀────────────┘
│   (Edge)        │    │  браузером      │
└─────────────────┘    └──────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌──────────────────┐
│   Веб-сайт      │◀───│  Взаимодействие  │
│   (Ozon ПВЗ)    │    │  с элементами   │
└─────────────────┘    └──────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌──────────────────┐
│   Результаты    │◀───│  Извлечение      │
│   (данные)      │    │  данных          │
└─────────────────┘    └──────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌──────────────────┐
│   Файл отчета   │◀───│  Форматирование │
│   (JSON/CSV/XML)│    │  и сохранение   │
└─────────────────┘    └──────────────────┘
```

## Основные потоки выполнения

### 1. Стандартный поток выполнения парсера

```
1. [setup_browser()] - Настройка браузера
2. [login()] - Вход в систему
3. [navigate_to_target()] - Навигация к целевой странице
4. [extract_data()] - Извлечение данных
5. [logout()] - Выход из системы
6. [close_browser()] - Закрытие браузера
```

### 2. Мульти-шаговая обработка

Для сложных отчетов используется мульти-шаговая обработка:

```
1. [run_parser()] - Запуск парсера
2. [_execute_multi_step_processing()] - Выполнение мульти-шаговой обработки
   ├── [navigate_to_target()] - Навигация к целевой странице для шага
   ├── [_execute_single_step()] - Выполнение одного шага
   │   ├── [_handle_simple_extraction()] - Простое извлечение
   │   ├── [_handle_table_extraction()] - Табличное извлечение
   │   └── [_handle_table_nested_extraction()] - Вложенное табличное извлечение
   └── [_combine_step_results()] - Комбинирование результатов шагов
3. [save_report()] - Сохранение отчета
```

## Конфигурация

Парсер использует гибкую систему конфигурации через словарь, позволяющую настраивать:
- Параметры браузера
- Селекторы для элементов
- Параметры извлечения данных
- Настройки форматирования и сохранения отчетов
- Параметры аутентификации
- Таймауты и задержки

## Поддерживаемые форматы отчетов

- JSON
- CSV
- XML
- Другие форматы (расширяемо)

## Особенности реализации

- **Универсальность**: Поддержка различных веб-систем через наследование
- **Масштабируемость**: Возможность добавления новых типов отчетов
- **Надежность**: Обработка ошибок и логирование
- **Гибкость**: Поддержка различных режимов работы и конфигураций
- **Мульти-шаговая обработка**: Поддержка сложных сценариев извлечения данных
- **Интеграция с ПВЗ**: Специфичная логика для работы с Ozon ПВЗ

## Ссылки на подробную документацию

Для получения подробной информации о конкретных методах см. соответствующие файлы документации:

- [BaseParser](BaseParser/) - документация методов базового парсера
- [BaseReportParser](BaseReportParser/) - документация методов парсера отчетов
- [OzonReportParser](OzonReportParser/) - документация методов парсера Ozon ПВЗ