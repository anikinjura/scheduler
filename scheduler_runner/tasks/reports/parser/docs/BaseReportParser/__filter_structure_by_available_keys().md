# Метод `__filter_structure_by_available_keys()`

## Версия
**0.0.1**

## Описание
Метод `__filter_structure_by_available_keys()` рекурсивно фильтрует структуру данных, оставляя только те плейсхолдеры, для которых есть соответствующие ключи в предоставленном списке доступных ключей.

## Назначение
Метод используется в процессе мульти-шаговой обработки для фильтрации структуры результата, чтобы убедиться, что в финальном результате остаются только те плейсхолдеры, для которых есть соответствующие значения для подстановки.

## Параметры
- `data` - данные любого типа (строка, словарь, список и т.д.), которые нужно отфильтровать
- `available_keys` - список или множество доступных ключей для замены плейсхолдеров

## Возвращаемое значение
Возвращает отфильтрованные данные, содержащие только допустимые плейсхолдеры. Если строка не содержит ни одного доступного плейсхолдера, метод возвращает `None`.

## Изменения в версии 0.0.1
- Метод используется в `_combine_step_results()` для фильтрации структуры результата
- Учитывает специальные плейсхолдеры, включая `__SOURCE_URL__`, который формируется как общий префикс всех `__STEP_SOURCE_URL__` из результатов шагов
- Обрабатывает структуру результата, включающую `__SOURCE_URL__`, который формируется с помощью метода `_get_common_url_prefix()`

## Особенности реализации
Метод теперь поддерживает специальные плейсхолдеры общей информации отчета:
- `__LOCATION_INFO__`
- `__EXTRACTION_TIMESTAMP__`
- `__SOURCE_URL__`
- `__EXECUTION_DATE__`

Эти специальные плейсхолдеры не удаляются из структуры даже если они не присутствуют в списке `available_keys`, поскольку они обрабатываются отдельно в методе `get_common_report_info()`.

## Рекурсивная обработка
- Обработка строк: Если переданный `data` является строкой, метод проверяет, содержит ли она хотя бы один доступный плейсхолдер в формате `{ключ}` или один из специальных плейсхолдеров. Если строка содержит хотя бы один доступный плейсхолдер, включая специальные (__LOCATION_INFO__, и т.д.), метод возвращает её. В противном случае возвращает `None`.
- Обработка словарей: Если переданный `data` является словарем, метод рекурсивно фильтрует значения словаря, оставляя только те пары ключ-значение, где значение не равно `None` после фильтрации.
- Обработка списков: Если переданный `data` является списком, метод рекурсивно фильтрует элементы списка, оставляя только те, которые не равны `None` после фильтрации.
- Обработка других типов данных: Для всех остальных типов данных метод возвращает значение без изменений.

## Пример использования
```python
data = {
    "source_url": "{__SOURCE_URL__}",
    "summary": {
        "giveout": "{nonexistent_key}",
        "direct_flow": "{direct_flow_data}"
    }
}

available_keys = {"__SOURCE_URL__", "direct_flow_data"}

result = parser.__filter_structure_by_available_keys(data, available_keys)
# Результат: {
#     "source_url": "{__SOURCE_URL__}",
#     "summary": {
#         "direct_flow": "{direct_flow_data}"
#     }
# }
```

## Особенности
- Метод учитывает специальные плейсхолдеры общей информации отчета (__LOCATION_INFO__, __EXTRACTION_TIMESTAMP__, __SOURCE_URL__, __EXECUTION_DATE__)
- `__SOURCE_URL__` формируется как общий префикс всех `__STEP_SOURCE_URL__` из результатов шагов с помощью метода `_get_common_url_prefix()`
- Метод рекурсивно обрабатывает вложенные структуры данных